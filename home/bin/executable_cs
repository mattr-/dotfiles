#!/usr/bin/env bash

set -e

# GitHub CLI Codespaces helpers
if [[ $# > 0 ]]; then
  case "$1" in
    delete)
      cs_id=$(gh cs list | fzf | cut -f1)
      [[ -n "$cs_id" ]] && gh cs delete -c $cs_id
      ;;
    ssh)
      cs_id=$(gh cs list | fzf | cut -f1)
      [[ -n "$cs_id" ]] && gh cs ssh -c $cs_id -- -R 127.0.0.1:7391:$(rdm socket)
      ;;
    create)
      shift
      repo="$(gh repo view --json nameWithOwner --jq .nameWithOwner)"
      branch="$(gh repo view --json defaultBranchRef --jq .defaultBranchRef.name)"
      gh cs create \
        -R "$repo" \
        -b "$branch" \
        --devcontainer-path .devcontainer/devcontainer.json \
        --idle-timeout 4h
        "$@"
      ;;
    *)
      gh cs "$@"
      ;;
  esac
else
  gh cs
fi
